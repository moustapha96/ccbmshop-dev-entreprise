import{m as z,J as te,u as ae,j as t,M as P,C as se,f as I,B as E,c as R,E as re,d as h,K as ne}from"./index.90da8569.js";import{a as oe,r as p}from"./vendor.cc591588.js";import{P as ie}from"./paimentService.87c924f7.js";/**
 * @license lucide-react v0.400.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ce=z("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);/**
 * @license lucide-react v0.400.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const le=z("QrCode",[["rect",{width:"5",height:"5",x:"3",y:"3",rx:"1",key:"1tu5fj"}],["rect",{width:"5",height:"5",x:"16",y:"3",rx:"1",key:"1v8r4q"}],["rect",{width:"5",height:"5",x:"3",y:"16",rx:"1",key:"1x03jg"}],["path",{d:"M21 16h-3a2 2 0 0 0-2 2v3",key:"177gqh"}],["path",{d:"M21 21v.01",key:"ents32"}],["path",{d:"M12 7v3a2 2 0 0 1-2 2H7",key:"8crl2c"}],["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M12 3h.01",key:"n36tog"}],["path",{d:"M12 16v.01",key:"133mhm"}],["path",{d:"M16 12h1",key:"1slzba"}],["path",{d:"M21 12v.01",key:"1lwtk9"}],["path",{d:"M12 21v-1",key:"1880an"}]]);class de{constructor(){this.baseUrl="https://orbitcity.odoo.com/",this.apiKey="your_wave_api_key_here",this.secretKey="your_wave_secret_key_here",this.environment="sandbox"}getHeaders(){return{"Content-Type":"application/json",Authorization:`Bearer ${this.apiKey}`,"Wave-Secret":this.secretKey}}getRedirectUrls(a,s="wave"){const e=window.location.origin;return{success_url:`${e}/payment/success?payment_method=${s}&reference=${a}`,error_url:`${e}/payment/error?payment_method=${s}&reference=${a}`}}async initiatePayment(a,s,e,r){try{const n=this.getRedirectUrls(r,"wave"),i=await fetch(`${this.baseUrl}/checkout/sessions`,{method:"POST",headers:this.getHeaders(),body:JSON.stringify({amount:a,currency:"XOF",...n,client_reference:r,payment_method:"wave_money",customer:{phone_number:s},metadata:{description:e,order_reference:r}})});if(!i.ok){const c=await i.json();throw new Error(`Échec de l'initiation du paiement Wave: ${c.message||i.status}`)}const l=await i.json();return{sessionId:l.id,checkoutUrl:l.checkout_url,status:l.status,reference:r,transactionId:l.id}}catch(n){throw console.error("Erreur initiation paiement Wave:",n),n}}async initiateDirectPayment(a){console.log("Initiating direct payment with body:",a);try{const s=await fetch(`${this.baseUrl}api/payment/wave/initiate`,{method:"POST",body:JSON.stringify(a)});if(!s.ok){const r=await s.json();throw new Error(`Échec de l'initiation du paiement direct Wave: ${r.message||s.status}`)}return await s.json()}catch(s){throw console.error("Erreur paiement direct Wave:",s),s}}async createPaymentLink(a,s,e,r=null){try{const n=this.getRedirectUrls(e,"wave"),i={amount:a,currency:"XOF",client_reference:e,description:s,...n,metadata:{order_reference:e}};r&&(i.expires_at=r);const l=await fetch(`${this.baseUrl}/checkout/sessions`,{method:"POST",headers:this.getHeaders(),body:JSON.stringify(i)});if(!l.ok){const w=await l.json();throw new Error(`Échec de création du lien: ${w.message||l.status}`)}const c=await l.json();return{sessionId:c.id,paymentUrl:c.checkout_url,qrCode:c.qr_code_url,expiresAt:c.expires_at,status:c.status,transactionId:c.id}}catch(n){throw console.error("Erreur création lien Wave:",n),n}}async checkTransactionStatus(a){try{const s=await fetch(`${this.baseUrl}api/payment/wave/status/${a}`,{method:"GET"});if(!s.ok){const r=await s.json();throw new Error(`Échec de la vérification du statut Wave: ${r.message||s.status}`)}return await s.json()}catch(s){throw console.error("Erreur vérification statut Wave:",s),s}}mapWaveStatus(a){return{pending:"pending",processing:"pending",succeeded:"completed",failed:"failed",cancelled:"cancelled",expired:"expired"}[a]||"unknown"}async getTransactionDetails(a){try{const s=await fetch(`${this.baseUrl}/transactions/${a}`,{method:"GET",headers:this.getHeaders()});if(!s.ok){const r=await s.json();throw new Error(`Échec de récupération des détails: ${r.message||s.status}`)}const e=await s.json();return{id:e.id,amount:e.amount,currency:e.currency,status:this.mapWaveStatus(e.status),phoneNumber:e.phone_number,reference:e.client_reference,createdAt:e.created_at,completedAt:e.completed_at,metadata:e.metadata}}catch(s){throw console.error("Erreur récupération détails Wave:",s),s}}async validatePhoneNumber(a){try{const s=await fetch(`${this.baseUrl}/phone-numbers/validate`,{method:"POST",headers:this.getHeaders(),body:JSON.stringify({phone_number:a,country:"SN"})});if(!s.ok)return{valid:!1,message:"Numéro invalide"};const e=await s.json();return{valid:e.valid,formatted:e.formatted_number,carrier:e.carrier,message:e.message}}catch(s){return console.error("Erreur validation numéro Wave:",s),{valid:!1,message:"Erreur de validation"}}}}const N=new de;class ue{constructor(){this.baseUrl="https://orbitcity.odoo.com/",this.apiToken=null,this.tokenExpiry=null,this.partnerId=null,this.sessionId=null}async authenticate(a,s,e="odoo"){try{const r=await fetch(`${this.baseUrl}web/session/authenticate`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({jsonrpc:"2.0",method:"call",params:{db:e,login:a,password:s}})});if(!r.ok)throw new Error(`Échec de l'authentification Odoo: ${r.status}`);const n=await r.json();if(n.error)throw new Error(`Erreur d'authentification: ${n.error.message}`);if(n.result&&n.result.uid)return this.sessionId=r.headers.get("set-cookie"),this.partnerId=n.result.partner_id,this.tokenExpiry=Date.now()+8*60*60*1e3,console.log("Authentification Odoo réussie"),{success:!0,userId:n.result.uid,partnerId:this.partnerId,sessionId:this.sessionId};throw new Error("Authentification échouée")}catch(r){throw console.error("Erreur d'authentification Odoo:",r),r}}async authenticateWithToken(a){return this.apiToken=a,this.tokenExpiry=Date.now()+24*60*60*1e3,a}async ensureValidSession(){if(!this.sessionId||!this.tokenExpiry||Date.now()>=this.tokenExpiry)throw new Error("Session expirée, veuillez vous reconnecter");return!0}async getOrangeToken(){await this.ensureValidSession();try{const a=await fetch(`${this.baseUrl}api/orange_money/token`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:this.apiToken?`Bearer ${this.apiToken}`:void 0,Cookie:this.sessionId||void 0},body:JSON.stringify({})});if(!a.ok)throw new Error(`Échec de l'obtention du token Orange Money: ${a.status}`);const s=await a.json();if(!s.success)throw new Error(s.error||"Erreur lors de l'obtention du token");return s.data}catch(a){throw console.error("Erreur obtention token Orange Money:",a),a}}async generateQRCode(a,s,e="123456",r="CCBM_SHOP",n=300,i=null,l){try{const c={amount:a,description:s,merchant_code:e,business_name:r,validity:n,partner_id:l,order_id:i};console.log("Génération QR Code via Odoo avec body:",c);const w=await fetch(`${this.baseUrl}api/orange_money/qrcode/generate`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:this.apiToken?`Bearer ${this.apiToken}`:void 0,Cookie:this.sessionId||void 0},body:JSON.stringify(c)});if(!w.ok){const d=await w.text();throw console.error("Erreur API Odoo:",d),new Error(`Échec de la génération du QR Code: ${w.status} - ${d}`)}const y=await w.json();if(!y.success)throw new Error(y.error||"Erreur lors de la génération du QR Code");return console.log("Réponse API Odoo:",y.data),{qrCode:y.data.qr_code,transactionId:y.data.transaction_id,odooTransactionId:y.data.odoo_transaction_id,reference:y.data.reference,status:"PENDING",amount:y.data.amount,validity:y.data.validity,deeplinks:y.data.deeplinks||{}}}catch(c){throw console.error("Erreur génération QR Code via Odoo:",c),c}}async createTransaction(a,s="",e="pending",r=null,n=null){if(await this.ensureValidSession(),!this.partnerId)throw new Error("Partner ID manquant, veuillez vous authentifier");try{const i={amount:a,phone:s,status:e,reference:r||`REF-${Date.now()}`,partner_id:this.partnerId,order_id:n},l=await fetch(`${this.baseUrl}api/orange_money/transaction/create`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:this.apiToken?`Bearer ${this.apiToken}`:void 0,Cookie:this.sessionId||void 0},body:JSON.stringify(i)});if(!l.ok)throw new Error(`Échec de la création de transaction: ${l.status}`);const c=await l.json();if(!c.success)throw new Error(c.error||"Erreur lors de la création de la transaction");return c.data}catch(i){throw console.error("Erreur création transaction:",i),i}}async updateTransaction(a,s){await this.ensureValidSession();try{const e=await fetch(`${this.baseUrl}api/orange_money/transaction/update/${a}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:this.apiToken?`Bearer ${this.apiToken}`:void 0,Cookie:this.sessionId||void 0},body:JSON.stringify(s)});if(!e.ok)throw new Error(`Échec de la mise à jour de transaction: ${e.status}`);const r=await e.json();if(!r.success)throw new Error(r.error||"Erreur lors de la mise à jour de la transaction");return r.data}catch(e){throw console.error("Erreur mise à jour transaction:",e),e}}async getPartnerTransactions(a=20,s=0,e=null,r=null,n=null){if(await this.ensureValidSession(),!this.partnerId)throw new Error("Partner ID manquant, veuillez vous authentifier");try{let i=`${this.baseUrl}api/orange_money/transactions/${this.partnerId}?limit=${a}&offset=${s}`;e&&(i+=`&status=${e}`),r&&(i+=`&date_from=${r}`),n&&(i+=`&date_to=${n}`);const l=await fetch(i,{method:"GET",headers:{Authorization:this.apiToken?`Bearer ${this.apiToken}`:void 0,Cookie:this.sessionId||void 0}});if(!l.ok)throw new Error(`Échec de la récupération des transactions: ${l.status}`);const c=await l.json();if(!c.success)throw new Error(c.error||"Erreur lors de la récupération des transactions");return c.data}catch(i){throw console.error("Erreur récupération transactions:",i),i}}async getTransaction(a){await this.ensureValidSession();try{const s=await fetch(`${this.baseUrl}api/orange_money/transaction/${a}`,{method:"GET",headers:{Authorization:this.apiToken?`Bearer ${this.apiToken}`:void 0,Cookie:this.sessionId||void 0}});if(!s.ok)throw new Error(`Échec de la récupération de la transaction: ${s.status}`);const e=await s.json();if(!e.success)throw new Error(e.error||"Erreur lors de la récupération de la transaction");return e.data}catch(s){throw console.error("Erreur récupération transaction:",s),s}}async checkTransactionStatus(a){await this.ensureValidSession();try{console.log("Vérification du statut de la transaction via Odoo:",a);const s=await fetch(`${this.baseUrl}api/orange_money/transaction/status/${a}`,{method:"GET",headers:{Authorization:this.apiToken?`Bearer ${this.apiToken}`:void 0,Cookie:this.sessionId||void 0}});if(console.log("Réponse API Odoo pour le statut:",s.status),!s.ok)throw new Error(`Échec de la vérification du statut: ${s.status}`);const e=await s.json();if(!e.success)throw new Error(e.error||"Erreur lors de la vérification du statut");return console.log("Réponse statut transaction via Odoo:",e.data),{status:e.data.mapped_status,rawStatus:e.data.orange_status,transactionId:e.data.transaction_id,updatedLocally:e.data.updated_locally}}catch(s){throw console.error("Erreur vérification statut via Odoo:",s),s}}async getPartnerStats(){if(await this.ensureValidSession(),!this.partnerId)throw new Error("Partner ID manquant, veuillez vous authentifier");try{const a=await fetch(`${this.baseUrl}api/orange_money/stats/${this.partnerId}`,{method:"GET",headers:{Authorization:this.apiToken?`Bearer ${this.apiToken}`:void 0,Cookie:this.sessionId||void 0}});if(!a.ok)throw new Error(`Échec de la récupération des statistiques: ${a.status}`);const s=await a.json();if(!s.success)throw new Error(s.error||"Erreur lors de la récupération des statistiques");return s.data}catch(a){throw console.error("Erreur récupération statistiques:",a),a}}async getConfig(){try{const a=await fetch(`${this.baseUrl}api/orange_money/config`,{method:"GET",headers:{Authorization:this.apiToken?`Bearer ${this.apiToken}`:void 0,Cookie:this.sessionId||void 0}});if(!a.ok)throw new Error(`Échec de la récupération de la configuration: ${a.status}`);const s=await a.json();if(!s.success)throw new Error(s.error||"Erreur lors de la récupération de la configuration");return s.data}catch(a){throw console.error("Erreur récupération configuration:",a),a}}mapOrangeStatus(a){return{PENDING:"pending",ACCEPTED:"accepted",SUCCESSFUL:"completed",SUCCESS:"completed",FAILED:"failed",EXPIRED:"expired",CANCELLED:"cancelled",REJECTED:"rejected"}[a]||"unknown"}async monitorTransaction(a,s=10,e=5e3){console.log(`Surveillance de la transaction ${a} via Odoo...`);for(let r=1;r<=s;r++)try{const n=await this.checkTransactionStatus(a);if(console.log(`Tentative ${r}${s} - Statut: ${n.rawStatus}`),["SUCCESSFUL","SUCCESS","FAILED","EXPIRED","CANCELLED","REJECTED"].includes(n.rawStatus))return console.log(`Transaction terminée avec le statut: ${n.rawStatus}`),n;r<s&&(console.log(`Attente de ${e}ms avant la prochaine vérification...`),await new Promise(l=>setTimeout(l,e)))}catch(n){if(console.error(`Erreur lors de la tentative ${r}:`,n),r===s)throw n;await new Promise(i=>setTimeout(i,e))}throw new Error(`Timeout: La transaction ${a} n'a pas abouti après ${s} tentatives`)}openQRCode(a,s){if(!a){console.error("Aucune donnée QR Code à ouvrir");return}try{if(a.startsWith("http")){window.open(a,"_blank","width=400,height=400");return}if(a.startsWith("data:image")){const e=window.open("","_blank","width=400,height=400");e&&(e.document.write(`
                          <html>
                              <head><title>QR Code Orange Money</title></head>
                              <body style="margin:0;padding:20px;text-align:center;font-family:Arial,sans-serif;">
                                  <h3>QR Code Orange Money</h3>
                                  <img src="${a}" alt="QR Code" style="max-width:100%;height:auto;border:2px solid #ff6600;border-radius:8px;">
                                  <p style="margin-top:15px;color:#666;">Référence: ${s}</p>
                                  <button onclick="window.print()" style="margin-top:10px;padding:8px 16px;background:#ff6600;color:white;border:none;border-radius:4px;cursor:pointer;">Imprimer</button>
                              </body>
                          </html>
                      `),e.document.close());return}console.warn("Format de QR Code non reconnu:",a.substring(0,50))}catch(e){console.error("Erreur lors de l'ouverture du QR Code:",e)}}async logout(){try{this.sessionId&&await fetch(`${this.baseUrl}web/session/destroy`,{method:"POST",headers:{"Content-Type":"application/json",Cookie:this.sessionId}})}catch(a){console.error("Erreur lors de la déconnexion:",a)}finally{this.sessionId=null,this.apiToken=null,this.partnerId=null,this.tokenExpiry=null}}}const S=new ue,he="/assets/orange.ac650953.png",Q="/assets/wave.799f7a3d.png",me=({handlePay:M,totalAmount:a,onClose:s,order:e,idOrder:r})=>{localStorage.setItem("idOrderPayment",null),localStorage.setItem("montant",null),localStorage.setItem("tokenOrderPayment",null),localStorage.setItem("statusOrderPayment",null),console.log("arrivé");const n=oe(),{payment:i,setUserPayment:l,setOrder:c,setPaymentDetails:w,setTotalAmount:y}=p.useContext(te),{user:d}=ae(),[x,v]=p.useState(!1),[F,T]=p.useState(!0),[m,U]=p.useState(""),[b,O]=p.useState(""),[q,B]=p.useState(!1),[V,X]=p.useState(""),[$,D]=p.useState("");p.useState("");const[_,L]=p.useState(null),[C,A]=p.useState(null);p.useEffect(()=>{l(d),c(e),console.log("order "+r),console.log("montant "+a),console.log("user",d)},[]);const J=()=>{let o=null;return e.type_sale==="order"?e.payment_mode=="echelonne"?o=`${d.id}-${r}-${a}-${e.name}-${e.type_sale}-${new Date().getTime().toString()}`:o=`${d.id}-${r}-${a}-${e.name}-${e.type_sale}`:e.type_sale==="preorder"?!e.first_payment_state&&!e.second_payment_state&&!e.third_payment_state?o=`${d.id}-${r}-${a}-${e.name}-${e.type_sale}-1`:e.first_payment_state&&!e.second_payment_state&&!e.third_payment_state?o=`${d.id}-${r}-${a}-${e.name}-${e.type_sale}-2`:o=`${d.id}-${r}-${a}-${e.name}-${e.type_sale}-3`:e.type_sale==="creditorder"?!e.first_payment_state&&!e.second_payment_state&&!e.third_payment_state&&!e.fourth_payment_state?o=`${d.id}-${r}-${a}-${e.name}-${e.type_sale}-1`:e.first_payment_state&&!e.second_payment_state&&!e.third_payment_state&&!e.fourth_payment_state?o=`${d.id}-${r}-${a}-${e.name}-${e.type_sale}-2`:e.first_payment_state&&e.second_payment_state&&e.third_payment_state&&!e.fourth_payment_state?o=`${d.id}-${r}-${a}-${e.name}-${e.type_sale}-3`:o=`${d.id}-${r}-${a}-${e.name}-${e.type_sale}-4`:o=`${d.id}-${r}-${a}-${e.name}-${e.type_sale}`,o},H=async o=>{if(o.preventDefault(),!m){h.error("Veuillez sélectionner une méthode de paiement",{position:"top-center",autoClose:3e3});return}if(m==="wave"&&!b){h.error("Veuillez entrer votre numéro de téléphone Wave",{position:"top-center",autoClose:3e3});return}v(!0);const g=J();try{ne(r,a,e.order_lines.map(f=>({name:f.product_name,price:f.price_unit,quantity:f.product_uom_qty})));const j=`REF-${e.name}-${Math.floor(Math.random()*1e6)}`;X(j);let u;if(m==="wave"){let f=null;e.type_sale==="preorder"?f=window.location.origin+`/pre-commandes/${r}/détails`:e.type_sale==="creditorder"?f=window.location.origin+`/credit-commandes/${r}/détails`:f=window.location.origin+`/commandes/${r}/détails`;let W={amount:a,phoneNumber:b,description:`Paiement de ${a} FCFA pour la commande ${e.name}`,reference:j,transaction_id:g,partner_id:d?d.id:null,order_id:r,success_url:window.location.origin+"/wave-paiement"};if(console.log(W),u=await N.initiateDirectPayment(W),console.log(u),u.status==="pending"&&u.success?(D(u.transaction_id||u.session_id),u.payment_url?window.open(u.payment_url,"_blank"):h.warning("Aucun lien de paiement trouvé",{position:"top-center",autoClose:3e3})):u.status==="cancelled"?(h.warning("Paiement annulé",{position:"top-center",autoClose:3e3}),e.type_sale==="preorder"?n(`/pre-commandes/${r}/détails`):e.type_sale==="creditorder"?n(`/credit-commandes/${r}/détails`):n(`/commandes/${r}/détails`)):u.status==="failed"&&(h.warning("Paiement echoué",{position:"top-center",autoClose:3e3}),e.type_sale==="preorder"?n(`/pre-commandes/${r}/détails`):e.type_sale==="creditorder"?n(`/credit-commandes/${r}/détails`):n(`/commandes/${r}/détails`)),u.status==="pending"&&u.success){const k=await N.checkTransactionStatus(u.transaction_id);console.log(k),k.status==="success"&&k.checkout_status==="complete"&&k.payment_status==="succeeded"&&(h.success("Paiement effectué avec succès",{position:"top-center",autoClose:3e3}),e.type_sale==="preorder"?n(`/pre-commandes/${r}/détails`):e.type_sale==="creditorder"?n(`/credit-commandes/${r}/détails`):n(`/commandes/${r}/détails`))}}else{const f={amount:a,partnerId:d.id,description:`Paiement de ${a} FCFA pour la commande ${e.name}`,merchantCode:"123456",businessName:"CCBM SHOP",validity:300};console.log(f),u=await S.generateQRCode(a,`Paiement de ${a} FCFA pour la commande ${e.name}`,"123456","CCBM SHOP",300,r,d.id),L(u.qrCode),A(u),D(u.transactionId),console.log("QR Code généré:",u)}B(!0),m==="wave"?h.success("Demande de paiement effectif pour Wave",{position:"top-center",autoClose:5e3}):h.success("QR Code Orange Money généré avec succès. Vous pouvez maintenant le scanner.",{position:"top-center",autoClose:5e3})}catch(j){console.error("Erreur lors du paiement:",j),h.error(`Erreur lors du paiement: ${j.message}`,{position:"top-center",autoClose:5e3})}finally{v(!1)}},G=async()=>{v(!0);try{let o;if(m==="wave"&&(o=await N.checkTransactionStatus($),o.status==="pending"&&o.success)){const g=await N.checkTransactionStatus(o.transaction_id);console.log(g),g.status==="success"&&g.checkout_status==="complete"&&g.payment_status==="succeeded"&&(h.success("Paiement effectué avec succès",{position:"top-center",autoClose:3e3}),e.type_sale==="preorder"?n(`/pre-commandes/${r}/détails`):e.type_sale==="creditorder"?n(`/credit-commandes/${r}/détails`):n(`/commandes/${r}/détails`))}o.status==="completed"?(h.success("Paiement confirmé avec succès!",{position:"top-center",autoClose:3e3}),e.type_sale==="preorder"?n(`/pre-commandes/${r}/détails`):e.type_sale==="creditorder"?n(`/credit-commandes/${r}/détails`):n(`/commandes/${r}/détails`),T(!1)):h.warning("Le paiement est toujours en attente. Veuillez vérifier et confirmer le paiement.",{position:"top-center",autoClose:5e3})}catch(o){console.error("Erreur lors de la vérification du paiement:",o),h.error(`Erreur lors de la vérification: ${o.message}`,{position:"top-center",autoClose:5e3})}finally{v(!1)}},K=()=>{T(!1),s()},Y=()=>{if(_){const o=document.createElement("a");o.href=_,o.download=`qr-code-orange-money-${$}.png`,o.click()}},Z=()=>{_&&S&&S.openQRCode(_,$)},ee=async()=>{if(m==="orange"&&$)try{v(!0),h.info("Surveillance automatique du paiement démarrée...",{position:"top-center",autoClose:3e3}),(await S.monitorTransaction($,10,3e4)).status==="completed"&&(await ie.updatePaymentDetails(localStorage.getItem("idDataPayment"),"completed","",d.name,d.email,b,"completed"),h.success("Paiement confirmé automatiquement!",{position:"top-center",autoClose:3e3}),setTimeout(()=>{e.type_sale==="preorder"?n(`/pre-commandes/${r}/détails`):e.type_sale==="creditorder"?n(`/credit-commandes/${r}/détails`):n(`/commandes/${r}/détails`),T(!1)},2e3))}catch(o){console.error("Erreur lors de la surveillance:",o),h.warning("Surveillance automatique échouée. Veuillez vérifier manuellement.",{position:"top-center",autoClose:5e3})}finally{v(!1)}};return t.jsxs(P,{size:"xl",className:"h-auto",show:F,popup:!0,onClose:s,children:[t.jsx(P.Header,{}),t.jsx(P.Body,{children:t.jsx("div",{className:"fixed inset-0 p-4 flex flex-wrap justify-center items-center w-full h-full z-[1000] before:fixed before:inset-0 before:w-full before:h-full before:bg-[rgba(0,0,0,0.5)] overflow-auto font-[sans-serif]",children:t.jsxs("div",{className:"w-full max-w-lg bg-white shadow-lg rounded-lg p-8 relative",children:[t.jsxs("div",{className:"flex items-start border-b border-gray-300 pb-4",children:[t.jsxs("div",{className:"flex-1",children:[t.jsxs("h3",{className:"text-gray-800 text-xl font-bold",children:["Paiement"," ",e.type_sale=="order"?"Commande":e.type_sale=="preorder"?"Pré Commande":"Commande à crédit"," "]}),t.jsx("p",{className:"text-gray-600 text-sm mt-1",children:"Résumé détaillé de votre commande."})]}),t.jsx("p",{children:t.jsx(se,{onClick:K,className:"cursor-pointer hover:text-red-500 hover:scale-150 duration-300"})})]}),e&&t.jsx(t.Fragment,{children:t.jsxs("div",{className:"my-8",children:[t.jsx("table",{className:"w-full",children:t.jsx("thead",{children:t.jsxs("tr",{children:[t.jsx("th",{className:"text-left text-gray-800 text-sm py-2",children:"Nom de la commande :"}),t.jsx("th",{className:"text-right text-gray-800 text-sm py-2",children:e.name})]})})}),t.jsxs("table",{className:"w-full",children:[t.jsx("thead",{children:t.jsxs("tr",{children:[t.jsx("th",{className:"text-left text-gray-800 text-sm py-2",children:"Nom produit"}),t.jsx("th",{className:"text-right text-gray-800 text-sm py-2",children:"Prix total"})]})}),t.jsx("tbody",{children:e&&e.order_lines.map((o,g)=>t.jsxs("tr",{children:[t.jsxs("td",{className:"text-left text-gray-800 text-sm py-2",children:[o.product_name," (",o.product_uom_qty,")"," "]}),t.jsx("td",{className:"text-right text-gray-800 text-sm py-2 font-medium",children:I(o.price_total)})]},g))})]}),t.jsx("table",{className:"w-full",children:t.jsxs("thead",{children:[t.jsxs("tr",{children:[t.jsx("th",{className:"text-left text-gray-800 text-sm py-2",children:"Total Commande (en FCFA) :"}),t.jsx("th",{className:"text-right text-gray-800 text-sm py-2",children:I(Math.ceil(e.amount_total))})]}),e.payment_mode=="echelonne"&&t.jsxs("tr",{children:[t.jsx("th",{className:"text-left text-gray-800 text-sm py-2",children:"Total à payer (en FCFA) :"}),t.jsx("th",{className:"text-right text-gray-800 text-sm py-2",children:I(Math.ceil(a))})]})]})}),q?t.jsxs("div",{className:"mt-6",children:[m==="orange"&&_&&t.jsxs("div",{className:"mb-6 text-center",children:[t.jsx("h4",{className:"text-orange-800 font-medium mb-4",children:"QR Code Orange Money généré"}),t.jsx("div",{className:"flex justify-center mb-4",children:t.jsx("img",{src:"/images/orange-money-logo.png",alt:"Orange Money",className:"h-10 w-auto"})}),t.jsx("div",{className:"bg-white p-4 rounded-lg inline-block mb-4 border-2 border-orange-200",children:t.jsx("img",{src:_||"/placeholder.svg",alt:"QR Code Orange Money",className:"max-w-full h-auto max-h-64"})}),t.jsxs("div",{className:"flex flex-col gap-2 mb-4",children:[t.jsxs(E,{onClick:Z,className:"w-full bg-orange-500 hover:bg-orange-600",children:[t.jsx(re,{className:"mr-2 h-4 w-4"}),"Ouvrir le QR Code"]}),t.jsxs(E,{onClick:Y,variant:"outline",className:"w-full",children:[t.jsx(ce,{className:"mr-2 h-4 w-4"}),"Télécharger le QR Code"]}),t.jsx(E,{onClick:ee,className:"w-full bg-green-500 hover:bg-green-600",disabled:x,children:x?t.jsxs(t.Fragment,{children:[t.jsx(R,{className:"mr-2 h-4 w-4 animate-spin"}),"Surveillance..."]}):"Surveillance automatique"})]}),t.jsxs("div",{className:"text-sm text-gray-600 space-y-1",children:[t.jsxs("p",{children:["Référence: ",t.jsx("span",{className:"font-medium",children:$})]}),(C==null?void 0:C.validity)&&t.jsxs("p",{children:["Validité: ",t.jsxs("span",{className:"font-medium",children:[C.validity," secondes"]})]})]})]}),m==="wave"&&t.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6",children:[t.jsx("div",{className:"flex justify-center mb-4",children:t.jsx("img",{src:Q,alt:"Wave",className:"h-20 w-20"})}),t.jsx("h4",{className:"text-blue-800 font-medium mb-2",children:"Paiement Wave en attente"}),t.jsx("p",{className:"text-blue-700 text-sm",children:"Veuillez vérifier et confirmer le paiement."}),t.jsxs("p",{className:"text-blue-700 text-sm mt-2",children:["Référence: ",t.jsx("span",{className:"font-medium",children:V})]})]}),t.jsx("div",{className:"flex max-sm:flex-col items-center gap-4",children:t.jsx(E,{onClick:G,disabled:x,pill:!0,className:"rounded-lg px-5 py-2.5 font-medium w-full bg-green-600 hover:bg-green-700 text-white text-xl",children:x?t.jsxs(t.Fragment,{children:[t.jsx(R,{className:"mr-2 h-4 w-4 animate-spin"}),t.jsx("p",{children:"Vérification..."})]}):"Vérifier le paiement"})})]}):t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"mt-6 mb-4",children:[t.jsx("h4",{className:"text-gray-800 font-medium mb-3",children:"Choisissez votre méthode de paiement"}),t.jsxs("div",{className:"flex space-x-4",children:[t.jsx("div",{className:`flex-1 border rounded-lg p-4 cursor-pointer transition-all ${m==="wave"?"border-blue-500 bg-blue-50":"border-gray-300 hover:border-blue-300"}`,onClick:()=>{U("wave")},children:t.jsxs("div",{className:"flex flex-col items-center",children:[t.jsx("img",{src:Q,alt:"Wave",className:"h-12 w-auto mb-2"}),t.jsx("p",{className:"text-center font-medium",children:"Wave"})]})}),t.jsx("div",{className:`flex-1 border rounded-lg p-4 cursor-pointer transition-all ${m==="orange"?"border-orange-500 bg-orange-50":"border-gray-300 hover:border-orange-300"}`,onClick:()=>U("orange"),children:t.jsxs("div",{className:"flex flex-col items-center",children:[t.jsx("img",{src:he,alt:"Orange Money",className:"h-12 w-auto mb-2"}),t.jsx("p",{className:"text-center font-medium",children:"Orange Money"})]})})]})]}),m==="wave"&&t.jsxs("div",{className:"mt-4 mb-6",children:[t.jsx("label",{htmlFor:"phone",className:"block text-sm font-medium text-gray-700 mb-1",children:"Numéro de téléphone Wave"}),t.jsx("input",{type:"tel",id:"phone",value:b,onChange:o=>O(o.target.value),placeholder:"77 123 45 67",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"}),t.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Entrez votre numéro Wave (format: 77XXXXXXX ou 78XXXXXXX)"})]}),m==="orange"&&t.jsx("div",{className:"mt-4 mb-4",children:t.jsxs("div",{className:"bg-orange-50 border border-orange-200 rounded-lg p-4",children:[t.jsx("div",{className:"flex items-center justify-center mb-2",children:t.jsx(le,{className:"h-6 w-6 text-orange-600"})}),t.jsx("p",{className:"text-center text-sm text-orange-700",children:"Un QR Code sera généré pour votre paiement Orange Money"})]})}),t.jsx("div",{className:"flex max-sm:flex-col items-center gap-4 mt-8",children:t.jsx(E,{onClick:H,disabled:x||!m||m==="wave"&&!b,pill:!0,className:"rounded-lg px-5 py-2.5 font-medium w-full hover:bg-red-500 hover:text-white text-xl",children:x?t.jsxs(t.Fragment,{children:[t.jsx(R,{className:"mr-2 h-4 w-4 animate-spin"}),t.jsx("p",{children:"Traitement en cours..."})]}):"Payer maintenant"})})]})]})})]})})})]})},ge=me;export{ge as W};
