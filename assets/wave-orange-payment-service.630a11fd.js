import{c as ie,G as R,I as Ne,u as je,B as v,J as Ce,f as L,j as t,M as H,A as _e,D as se,t as Q,l as V}from"./index.adc269b6.js";import{r as c,u as ke}from"./vendor.af94f9e3.js";/**
 * @license lucide-react v0.400.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ee=ie("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.400.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $e=ie("QrCode",[["rect",{width:"5",height:"5",x:"3",y:"3",rx:"1",key:"1tu5fj"}],["rect",{width:"5",height:"5",x:"16",y:"3",rx:"1",key:"1v8r4q"}],["rect",{width:"5",height:"5",x:"3",y:"16",rx:"1",key:"1x03jg"}],["path",{d:"M21 16h-3a2 2 0 0 0-2 2v3",key:"177gqh"}],["path",{d:"M21 21v.01",key:"ents32"}],["path",{d:"M12 7v3a2 2 0 0 1-2 2H7",key:"8crl2c"}],["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M12 3h.01",key:"n36tog"}],["path",{d:"M12 16v.01",key:"133mhm"}],["path",{d:"M16 12h1",key:"1slzba"}],["path",{d:"M21 12v.01",key:"1lwtk9"}],["path",{d:"M12 21v-1",key:"1880an"}]]);class Se{constructor(){this.baseUrl="https://orbitcity.odoo.com/",this.environment={}.VITE_ORANGE_MONEY_ENV||"sandbox",this.merchantCode={}.VITE_ORANGE_MONEY_MERCHANT_CODE,this.merchantName={}.VITE_ORANGE_MONEY_MERCHANT_NAME||"Votre Commerce"}getHeaders(){return{"Content-Type":"application/json",Accept:"application/json"}}getRedirectUrls(a,e="orange_money"){const r=window.location.origin;return{success_url:`${r}/payment/success?payment_method=${e}&transaction_id=${a}`,error_url:`${r}/payment/error?payment_method=${e}&transaction_id=${a}`,cancel_url:`${r}/payment/cancel?payment_method=${e}&transaction_id=${a}`}}generateTransactionId(a=null){const e=new Date().toISOString().replace(/[-:T.]/g,"").slice(0,14),r=Math.floor(Math.random()*1e3).toString().padStart(3,"0");return`${a?`OM-${a}`:"OM"}-${e}-${r}`}async initiatePayment(a,e,r,o,u=null,j=null){try{const h=this.generateTransactionId(u),k=this.getRedirectUrls(h,"orange_money"),U={transaction_id:h,order_id:u,partner_id:j,phoneNumber:this.formatPhoneNumber(e),amount:Number.parseFloat(a),description:r||`Paiement Orange Money - ${o}`,currency:"XOF",reference:o,success_url:k.success_url,metadata:{order_reference:o,merchant_name:this.merchantName,environment:this.environment,initiated_at:new Date().toISOString()}};console.log("Initiating Orange Money payment with payload:",U);const $=await fetch(`${this.baseUrl}api/payment/orange/initiate`,{method:"POST",headers:this.getHeaders(),body:JSON.stringify(U)});if(!$.ok){const I=await $.json();throw new Error(`Échec de l'initiation du paiement Orange Money: ${I.error||I.message||$.status}`)}const g=await $.json();return{success:g.success,transactionId:g.transaction_id,orangeId:g.orange_id,paymentToken:g.pay_token,paymentUrl:g.payment_url,qrCodeUrl:g.qr_code_url,status:g.status||"INITIATED",orderId:g.order_id,partnerId:g.partner_id,reference:g.reference,successUrl:g.success_url,deepLink:g.deep_link,qrCodeBase:"data:image/png;base64,"+g.qr_code_base64,validitySeconds:g.validity_seconds,amount:a,phoneNumber:e,checkoutUrl:g.qr_code_url,sessionId:g.transaction_id,existing:g.existing||!1}}catch(h){throw console.error("Erreur initiation paiement Orange Money:",h),h}}async initiateDirectPayment(a){console.log("Initiating direct Orange Money payment with body:",a);try{const e=await fetch(`${this.baseUrl}api/payment/orange/initiate`,{method:"POST",headers:this.getHeaders(),body:JSON.stringify(a)});if(!e.ok){const o=await e.json();throw new Error(`Échec de l'initiation du paiement direct Orange Money: ${o.error||o.message||e.status}`)}return await e.json()}catch(e){throw console.error("Erreur paiement direct Orange Money:",e),e}}async createPaymentLink(a,e,r,o=null,u=null,j=null){try{const h=await this.initiatePayment(a,j,e,r,o,u);return{sessionId:h.transactionId,paymentUrl:h.qrCodeUrl,qrCode:h.qrCodeUrl,qrCodeUrl:h.qrCodeUrl,status:h.status,transactionId:h.transactionId,orangeId:h.orangeId,reference:r,amount:a,expiresAt:null,existing:h.existing}}catch(h){throw console.error("Erreur création lien Orange Money:",h),h}}async checkTransactionStatus(a){try{const e=await fetch(`${this.baseUrl}api/payment/orange/status/${a}`,{method:"GET",headers:this.getHeaders()});if(!e.ok){const o=await e.json();throw new Error(`Échec de la vérification du statut Orange Money: ${o.error||o.message||e.status}`)}const r=await e.json();return console.log("data ",r),r}catch(e){throw console.error("Erreur vérification statut Orange Money:",e),e}}async getTransactionByOrangeId(a){try{const e=await fetch(`${this.baseUrl}api/payment/orange/transaction/${a}`,{method:"GET",headers:this.getHeaders()});if(!e.ok){const o=await e.json();throw new Error(`Échec de récupération des détails Orange Money: ${o.error||o.message||e.status}`)}const r=await e.json();return{success:r.success,orangeTransaction:r.orange_transaction,localTransaction:r.local_transaction}}catch(e){throw console.error("Erreur récupération détails Orange Money:",e),e}}mapOrangeMoneyStatus(a){return{INITIATED:"pending",PENDING:"pending",ACCEPTED:"processing",SUCCESS:"completed",FAILED:"failed",CANCELLED:"cancelled",REJECTED:"failed"}[a]||"unknown"}async getTransactionDetails(a){try{const e=await this.checkTransactionStatus(a);return{id:e.transactionId,orangeId:e.orangeId,amount:e.amount,currency:e.currency,status:e.status,rawStatus:e.rawStatus,phoneNumber:e.phoneNumber,reference:e.reference,description:e.description,qrCodeUrl:e.qrCodeUrl,createdAt:e.createdAt,completedAt:e.completedAt,order:e.order,factureUrl:e.factureUrl,metadata:{order_id:e.orderId,partner_id:e.partnerId,refreshed:e.refreshed}}}catch(e){throw console.error("Erreur récupération détails Orange Money:",e),e}}formatPhoneNumber(a){if(!a)return"";const e=a.replace(/[\s\-$$$$.]/g,"");return e.startsWith("+221")?e:e.startsWith("221")?"+"+e:e.match(/^[73]/)?"+221"+e:e}async validatePhoneNumber(a){try{const e=this.formatPhoneNumber(a),o=/^\+221(77|78|70|76|75)[0-9]{7}$/.test(e);return{valid:o,formatted:e,carrier:o?"Orange Money":"Unknown",message:o?"Numéro Orange Money valide":"Numéro Orange Money invalide"}}catch(e){return console.error("Erreur validation numéro Orange Money:",e),{valid:!1,formatted:a,message:"Erreur de validation"}}}async getTransactionPartner(a){try{const e=await fetch(`${this.baseUrl}api/payment/orange/partner-transactions/${a}`,{method:"GET",headers:this.getHeaders()});if(!e.ok){const o=await e.json();throw new Error(`Échec de récupération des transactions: ${o.error||o.message||e.status}`)}const r=await e.json();return{success:r.success||!0,partnerId:r.partner_id||a,partnerName:r.partner_name,transactionsCount:r.transactions_count||r.length,transactions:r.transactions||r}}catch(e){throw console.error("Erreur récupération transactions partenaire Orange Money:",e),e}}async getPartnerTransactionsDetailed(a){try{const e=await fetch(`${this.baseUrl}api/payment/partner/${a}/orange-transactions`,{method:"GET",headers:this.getHeaders()});if(!e.ok){const o=await e.json();throw new Error(`Échec de récupération des transactions détaillées: ${o.error||o.message||e.status}`)}const r=await e.json();return{success:r.success,partner:r.partner,transactionsCount:r.transactions_count,transactions:r.transactions.map(o=>({...o,status:this.mapOrangeMoneyStatus(o.status),rawStatus:o.status}))}}catch(e){throw console.error("Erreur récupération transactions détaillées Orange Money:",e),e}}async checkAvailability(){try{const a=await fetch(`${this.baseUrl}api/payment/orange/status/test-availability`,{method:"GET",headers:this.getHeaders()});return{available:!0,environment:this.environment,merchantCode:this.merchantCode,merchantName:this.merchantName}}catch(a){return console.error("Orange Money service non disponible:",a),{available:!1,error:a.message}}}async cancelTransaction(a){try{return console.warn("L'annulation directe n'est pas supportée par Orange Money"),{success:!1,message:"L'annulation directe n'est pas supportée par Orange Money"}}catch(e){throw console.error("Erreur annulation transaction Orange Money:",e),e}}async getTransactionStats(a=null,e=null,r=null){try{let o=`${this.baseUrl}api/payment/orange/stats`;const u=new URLSearchParams;a&&u.append("partner_id",a),e&&u.append("date_from",e),r&&u.append("date_to",r),u.toString()&&(o+="?"+u.toString());const j=await fetch(o,{method:"GET",headers:this.getHeaders()});if(!j.ok){const k=await j.json();throw new Error(`Échec de récupération des statistiques: ${k.error||k.message||j.status}`)}return await j.json()}catch(o){throw console.error("Erreur récupération statistiques Orange Money:",o),o}}async downloadInvoice(a){try{const e=await fetch(`${this.baseUrl}api/payment/orange/invoice/${a}`,{method:"GET",headers:this.getHeaders()});if(!e.ok)throw new Error("Facture non disponible");const r=await e.blob(),o=window.URL.createObjectURL(r),u=document.createElement("a");return u.href=o,u.download=`facture-orange-money-${a}.pdf`,document.body.appendChild(u),u.click(),window.URL.revokeObjectURL(o),document.body.removeChild(u),{success:!0,message:"Facture téléchargée avec succès"}}catch(e){throw console.error("Erreur téléchargement facture Orange Money:",e),e}}openQRCode(a){a?window.open(a,"_blank","width=400,height=400,scrollbars=yes,resizable=yes"):console.error("URL du QR code non disponible")}async copyQRCodeUrl(a){try{return await navigator.clipboard.writeText(a),{success:!0,message:"URL du QR code copiée"}}catch(e){return console.error("Erreur copie URL QR code:",e),{success:!1,message:"Erreur lors de la copie"}}}_prepare_api_payment_data(a,e){return{transaction_id:a.get("transaction_id"),order_id:e.id,partner_id:e.partner_id.id,phoneNumber:a.get("phoneNumber",""),amount:Number.parseFloat(a.get("amount")),description:a.get("description",`Paiement pour la commande ${e.name}`),currency:a.get("currency",e.currency_id.name),reference:a.get("reference",e.name),success_url:a.get("success_url",`https://orbitcity.sn/orange-money-paiement?transaction=${a.get("transaction_id")}`)}}}const q=new Se,Pe=()=>{const[O,a]=c.useState(!1),[e,r]=c.useState(null),[o,u]=c.useState(null),j=c.useCallback(async(x,i,l,S,P=null,M=null)=>{a(!0),r(null);try{const f=await q.initiatePayment(x,i,l,S,P,M);return u(f),f}catch(f){throw r(f.message),f}finally{a(!1)}},[]),h=c.useCallback(async x=>{console.log(x),a(!0),r(null);try{const i=await q.checkTransactionStatus(x);return console.log(i),console.log("result resultat de la fonction "),u(i),i}catch(i){throw r(i.message),i}finally{a(!1)}},[]),k=c.useCallback(async(x,i,l,S=null,P=null,M=null)=>{a(!0),r(null);try{const f=await q.createPaymentLink(x,i,l,S,P,M);return u(f),f}catch(f){throw r(f.message),f}finally{a(!1)}},[]),U=c.useCallback(async x=>{try{return await q.validatePhoneNumber(x)}catch(i){return r(i.message),{valid:!1,message:i.message}}},[]),$=c.useCallback(async x=>{a(!0),r(null);try{return await q.getTransactionPartner(x)}catch(i){throw r(i.message),i}finally{a(!1)}},[]),g=c.useCallback(x=>{q.openQRCode(x)},[]),I=c.useCallback(async x=>{a(!0),r(null);try{return await q.downloadInvoice(x)}catch(i){throw r(i.message),i}finally{a(!1)}},[]);return{loading:O,error:e,transaction:o,initiatePayment:j,checkStatus:h,createPaymentLink:k,validatePhone:U,getPartnerTransactions:$,openQRCode:g,downloadInvoice:I,clearError:()=>r(null),clearTransaction:()=>u(null)}},Me=()=>{const[O,a]=c.useState(!1),[e,r]=c.useState(null),[o,u]=c.useState(null),j=c.useCallback(async i=>{a(!0),r(null);try{const l=await R.initiateDirectPayment(i);return u(l),l}catch(l){throw r(l.message),l}finally{a(!1)}},[]),h=c.useCallback(async(i,l,S,P,M=null,f=null)=>{a(!0),r(null);try{const _=await R.initiateDirectPayment(i,l,S,P,M,f);return u(_),_}catch(_){throw r(_.message),_}finally{a(!1)}},[]),k=c.useCallback(async i=>{a(!0),r(null),console.log(i);try{const l=await R.checkTransactionStatus(i);return u(l),l}catch(l){throw r(l.message),l}finally{a(!1)}},[]),U=c.useCallback(async(i,l,S,P=null,M=null,f=null)=>{a(!0),r(null);try{const _=await R.createPaymentLink(i,l,S,P,M,f);return u(_),_}catch(_){throw r(_.message),_}finally{a(!1)}},[]),$=c.useCallback(async i=>{try{return await R.validatePhoneNumber(i)}catch(l){return r(l.message),{valid:!1,message:l.message}}},[]),g=c.useCallback(async i=>{a(!0),r(null);try{return await R.getTransactionPartner(i)}catch(l){throw r(l.message),l}finally{a(!1)}},[]),I=c.useCallback(i=>{R.openCheckout(i)},[]),x=c.useCallback(async i=>{a(!0),r(null);try{return await R.downloadInvoice(i)}catch(l){throw r(l.message),l}finally{a(!1)}},[]);return{loading:O,error:e,transaction:o,initiatePayment:h,initiateDirectPayment:j,checkStatus:k,createPaymentLink:U,validatePhone:$,getPartnerTransactions:g,openCheckout:I,downloadInvoice:x,clearError:()=>r(null),clearTransaction:()=>u(null)}},oe="/assets/orange.ac650953.png",ce="/assets/wave.799f7a3d.png",Te=({handlePay:O,totalAmount:a,onClose:e,order:r,idOrder:o})=>{const u=ke(),{setUserPayment:j,setOrder:h}=c.useContext(Ne),{user:k}=je(),[U,$]=c.useState(),{loading:g,error:I,transaction:x,initiatePayment:i,checkStatus:l,validatePhone:S,openQRCode:P,downloadInvoice:M,clearError:f}=Pe(),{loading:_,error:G,transaction:Ie,initiateWavePayment:le,checkStatus:J,validatePhone:Y,clearError:K,initiateDirectPayment:ue}=Me(),[de,B]=c.useState(!0),[d,Z]=c.useState(""),[b,z]=c.useState(""),[me,he]=c.useState(!1),[ge,pe]=c.useState(""),[m,ee]=c.useState(null),[te,F]=c.useState(!1),[E,W]=c.useState({valid:!1,message:""}),D=g||_,C=c.useMemo(()=>k,[k]),n=c.useMemo(()=>r,[r]);c.useEffect(()=>{localStorage.removeItem("idOrderPayment"),localStorage.removeItem("montant"),localStorage.removeItem("tokenOrderPayment"),localStorage.removeItem("statusOrderPayment"),console.log("Order ID:",o),console.log("Amount:",a),console.log("User:",C),C&&j&&j(C),n&&h&&h(n)},[]);const ae=c.useCallback(async(s,y)=>{if(!s||!y)return W({valid:!1,message:""}),{valid:!1,message:""};try{let p;if(y==="wave")p=await Y(s);else if(y==="orange")p=await S(s);else{const w=/^(\+221)?(77|78|76|75|70)\d{7}$/;p={valid:w.test(s),message:w.test(s)?"Numéro valide":"Format de numéro invalide"}}return W(p),p}catch(p){console.error("Erreur validation numéro:",p);const w={valid:!1,message:"Erreur de validation"};return W(w),w}},[Y,S]);c.useEffect(()=>{if(!b||!d){W({valid:!1,message:""});return}const s=setTimeout(()=>{ae(b,d)},500);return()=>clearTimeout(s)},[b,d,ae]);const re=c.useCallback(()=>{const s=new Date().getTime(),y=Math.floor(Math.random()*1e3);let p=`${C==null?void 0:C.id}-${o}-${a}-${n==null?void 0:n.name}-${n==null?void 0:n.type_sale}`;if((n==null?void 0:n.type_sale)==="order"&&(n==null?void 0:n.payment_mode)==="echelonne")p+=`-${s}`;else if((n==null?void 0:n.type_sale)==="preorder"){const w=ye(n);p+=`-${w}`}else if((n==null?void 0:n.type_sale)==="creditorder"){const w=fe(n);p+=`-${w}`}return`${p}-${y}`},[C==null?void 0:C.id,o,a,n==null?void 0:n.name,n==null?void 0:n.type_sale,n==null?void 0:n.payment_mode]),ye=c.useCallback(s=>s!=null&&s.first_payment_state?s!=null&&s.second_payment_state?"3":"2":"1",[]),fe=c.useCallback(s=>s!=null&&s.first_payment_state?s!=null&&s.second_payment_state?s!=null&&s.third_payment_state?"4":"3":"2":"1",[]),X=c.useCallback(()=>{const s=window.location.origin;switch(n==null?void 0:n.type_sale){case"preorder":return`${s}/pre-commandes/${o}/détails`;case"creditorder":return`${s}/credit-commandes/${o}/détails`;default:return`${s}/commandes/${o}/détails`}},[n==null?void 0:n.type_sale,o]),xe=c.useCallback(async s=>{var y;if(s.preventDefault(),!d){v.error("Veuillez sélectionner une méthode de paiement",{position:"top-center",autoClose:3e3});return}if((d==="wave"||d==="orange")&&!b){v.error(`Veuillez entrer votre numéro de téléphone ${d==="wave"?"Wave":"Orange Money"}`,{position:"top-center",autoClose:3e3});return}if(b&&!E.valid){v.error(`Numéro invalide: ${E.message}`,{position:"top-center",autoClose:3e3});return}try{f(),K(),Ce(o,a,((y=n==null?void 0:n.order_lines)==null?void 0:y.map(A=>({name:A.product_name,price:A.price_unit,quantity:A.product_uom_qty})))||[]);const p=re(),w=`REF-${n==null?void 0:n.name}-${Date.now()}`;pe(w);const T=`Paiement de ${L(a)} pour la commande ${n==null?void 0:n.name}`;let N;if(d==="wave"){const A={amount:a,phoneNumber:b,description:`Paiement de ${a} pour la commande ${r.name}`,reference:`REF-${r.name}-${Date.now()}`,order_id:o,partner_id:k.id,transaction_id:p};N=await ue(A),console.log(N),N.success&&(ee(N),N.payment_url&&(window.open(N.payment_url,"_blank"),v.success("Lien de paiement Wave ouvert dans un nouvel onglet",{position:"top-center",autoClose:3e3})))}else d==="orange"&&(N=await i(a,b||"",T,w,o,C==null?void 0:C.id),console.log(N),N.success&&(ee(N),$(N.qrCodeBase),v.success("QR Code Orange Money généré avec succès",{position:"top-center",autoClose:3e3})));N&&N.success&&(he(!0),d==="orange"&&ne(N))}catch(p){console.error("Erreur lors du paiement:",p),console.log(p),v.error(`Erreur lors du paiement: ${p.message}`,{position:"top-center",autoClose:5e3})}},[d,b,E.valid,E.message,f,K,o,a,n,re,le,i,C==null?void 0:C.id]),ve=c.useCallback(async()=>{if(!m){v.error("Aucune transaction à vérifier",{position:"top-center",autoClose:3e3});return}try{let s;if(d==="wave"?(s=await J(m.transaction_id),console.log(s)):d==="orange"&&(s=await l(m.transactionId),console.log(s),console.log("verificationResult resultata verification Orange Money ")),s){const y=s.status||s.rawStatus;y==="completed"||y==="SUCCESS"?(v.success("Paiement confirmé avec succès!",{position:"top-center",autoClose:3e3}),setTimeout(()=>{u(X()),B(!1)},1500)):y==="failed"||y==="FAILED"?v.error("Le paiement a échoué",{position:"top-center",autoClose:5e3}):v.warning("Le paiement est toujours en attente",{position:"top-center",autoClose:5e3})}}catch(s){console.error("Erreur lors de la vérification du paiement:",s),v.error(`Erreur lors de la vérification: ${s.message}`,{position:"top-center",autoClose:5e3})}},[m,d,J,l,u,X]),ne=c.useCallback(async s=>{if(d!=="orange"||!s)return;F(!0),v.info("Surveillance automatique du paiement démarrée...",{position:"top-center",autoClose:3e3});const y=10,p=3e4;for(let w=1;w<=y;w++)try{await new Promise(N=>setTimeout(N,p));const T=await l(s.transactionId);if(T&&(T.status==="completed"||T.rawStatus==="SUCCESS")){v.success("Paiement confirmé automatiquement!",{position:"top-center",autoClose:3e3}),setTimeout(()=>{u(X()),B(!1)},2e3),F(!1);return}if(T&&(T.status==="failed"||T.rawStatus==="FAILED")){v.error("Paiement échoué détecté automatiquement",{position:"top-center",autoClose:5e3}),F(!1);return}}catch(T){console.error(`Erreur surveillance tentative ${w}:`,T)}F(!1),v.warning("Surveillance automatique terminée. Veuillez vérifier manuellement.",{position:"top-center",autoClose:5e3})},[d,l,u,X]),be=c.useCallback(()=>{B(!1),e()},[e]);c.useCallback(()=>{if(m&&m.qrCodeBase){const s=document.createElement("a");s.href=m.qrCodeUrl,s.download=`qr-code-orange-money-${m.transactionId}.png`,s.click()}},[m]),c.useCallback(()=>{m&&m.qrCodeBase&&P(m.qrCodeBase)},[m,P]),c.useCallback(async()=>{if(m&&m.transactionId)try{await M(m.transactionId),v.success("Facture téléchargée avec succès",{position:"top-center",autoClose:3e3})}catch{v.error("Erreur lors du téléchargement de la facture",{position:"top-center",autoClose:3e3})}},[m,M]);const we=c.useMemo(()=>{var s;return n?t.jsxs("div",{className:"my-8",children:[t.jsx("div",{className:"mb-4",children:t.jsxs("div",{className:"flex justify-between items-center mb-2",children:[t.jsx("span",{className:"text-gray-800 text-sm font-medium",children:"Nom de la commande:"}),t.jsx("span",{className:"text-gray-800 text-sm",children:n.name})]})}),t.jsxs("div",{className:"border rounded-lg p-4 mb-4",children:[t.jsx("h4",{className:"text-gray-800 text-sm font-medium mb-2",children:"Produits"}),(s=n.order_lines)==null?void 0:s.map((y,p)=>t.jsxs("div",{className:"flex justify-between items-center py-1",children:[t.jsxs("span",{className:"text-gray-700 text-sm",children:[y.product_name," (",y.product_uom_qty,")"]}),t.jsx("span",{className:"text-gray-800 text-sm font-medium",children:L(y.price_total)})]},p))]}),t.jsxs("div",{className:"border-t pt-4",children:[t.jsxs("div",{className:"flex justify-between items-center mb-2",children:[t.jsx("span",{className:"text-gray-800 font-medium",children:"Total Commande:"}),t.jsx("span",{className:"text-gray-800 font-bold",children:L(Math.ceil(n.amount_total))})]}),n.payment_mode==="echelonne"&&t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsx("span",{className:"text-blue-600 font-medium",children:"Total à payer:"}),t.jsx("span",{className:"text-blue-600 font-bold",children:L(Math.ceil(a))})]})]})]}):null},[n,a]);return t.jsxs(H,{size:"xl",className:"h-auto",show:de,popup:!0,onClose:e,children:[t.jsx(H.Header,{}),t.jsx(H.Body,{children:t.jsx("div",{className:"fixed inset-0 p-4 flex flex-wrap justify-center items-center w-full h-full z-[1000] before:fixed before:inset-0 before:w-full before:h-full before:bg-[rgba(0,0,0,0.5)] overflow-auto font-[sans-serif]",children:t.jsxs("div",{className:"w-full max-w-lg bg-white shadow-lg rounded-lg p-8 relative",children:[t.jsxs("div",{className:"flex items-start border-b border-gray-300 pb-4",children:[t.jsxs("div",{className:"flex-1",children:[t.jsxs("h3",{className:"text-gray-800 text-xl font-bold",children:["Paiement"," ",(n==null?void 0:n.type_sale)==="order"?"Commande":(n==null?void 0:n.type_sale)==="preorder"?"Pré Commande":"Commande à crédit"," "]}),t.jsx("p",{className:"text-gray-600 text-sm mt-1",children:"Résumé détaillé de votre commande."})]}),t.jsx(_e,{onClick:be,className:"cursor-pointer hover:text-red-500 hover:scale-110 duration-300"})]}),n&&t.jsxs(t.Fragment,{children:[we,me?t.jsxs("div",{className:"mt-6",children:[d==="orange"&&m&&m.qrCodeBase&&t.jsxs("div",{className:"mb-6 text-center",children:[t.jsx("div",{className:"flex justify-center mb-4",children:t.jsx("img",{src:oe,alt:"Orange Money",className:"h-10 w-auto"})}),t.jsx("div",{className:"bg-white p-4 rounded-lg inline-block mb-4 border-2 border-orange-200 shadow-lg",children:t.jsx("img",{src:m.qrCodeBase||"/placeholder.svg",alt:"QR Code Orange Money",className:"max-w-full h-auto max-h-64"})}),t.jsxs("div",{className:"grid grid-cols-1 gap-2 mb-4",children:[!te&&t.jsx(Q,{onClick:()=>ne(m),className:"w-full bg-green-500 hover:bg-green-600 text-white",disabled:D,children:D?t.jsxs(t.Fragment,{children:[t.jsx(V,{className:"mr-2 h-4 w-4 animate-spin"}),"Surveillance..."]}):"Démarrer surveillance automatique"}),te&&t.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-3",children:t.jsxs("div",{className:"flex items-center justify-center",children:[t.jsx(V,{className:"mr-2 h-4 w-4 animate-spin text-green-600"}),t.jsx("span",{className:"text-green-700 text-sm",children:"Surveillance active..."})]})})]}),t.jsxs("div",{className:"text-sm text-gray-600 space-y-1 bg-gray-50 p-3 rounded-lg",children:[t.jsxs("p",{children:[t.jsx("span",{className:"font-medium",children:"Référence:"})," ",m.transactionId]}),t.jsxs("p",{children:[t.jsx("span",{className:"font-medium",children:"Montant:"})," ",L(a)]}),m.existing&&t.jsx("p",{className:"text-blue-600",children:t.jsx("span",{className:"font-medium",children:"Transaction existante récupérée"})})]})]}),d==="wave"&&m&&t.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6",children:[t.jsx("div",{className:"flex justify-center mb-4",children:t.jsx("img",{src:ce,alt:"Wave",className:"h-20 w-20"})}),t.jsx("h4",{className:"text-blue-800 font-medium mb-2 text-center",children:"Paiement Wave initié"}),t.jsx("p",{className:"text-blue-700 text-sm text-center mb-3",children:"Le lien de paiement a été ouvert dans un nouvel onglet."}),t.jsxs("div",{className:"text-sm text-blue-600 space-y-1 bg-blue-100 p-3 rounded",children:[t.jsxs("p",{children:[t.jsx("span",{className:"font-medium",children:"Référence:"})," ",ge]}),t.jsxs("p",{children:[t.jsx("span",{className:"font-medium",children:"Transaction ID:"})," ",m.transactionId]}),t.jsxs("p",{children:[t.jsx("span",{className:"font-medium",children:"Téléphone:"})," ",b]})]}),m.checkoutUrl&&t.jsx(Q,{onClick:()=>window.open(m.checkoutUrl,"_blank"),className:"w-full mt-3 bg-blue-500 hover:bg-blue-600 text-white",children:"Rouvrir le lien de paiement"})]}),t.jsx("div",{className:"flex flex-col gap-3",children:t.jsx(Q,{onClick:ve,disabled:D,className:"w-full bg-green-600 hover:bg-green-700 text-white font-medium py-3 px-6 rounded-lg",children:D?t.jsxs(t.Fragment,{children:[t.jsx(V,{className:"mr-2 h-4 w-4 animate-spin"}),"Vérification..."]}):"Vérifier le paiement"})})]}):t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"mt-6 mb-4",children:[t.jsx("h4",{className:"text-gray-800 font-medium mb-3",children:"Choisissez votre méthode de paiement"}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsx("div",{className:`border rounded-lg p-4 cursor-pointer transition-all ${d==="wave"?"border-blue-500 bg-blue-50 ring-2 ring-blue-200":"border-gray-300 hover:border-blue-300"}`,onClick:()=>Z("wave"),children:t.jsxs("div",{className:"flex flex-col items-center",children:[t.jsx("img",{src:ce,alt:"Wave",className:"h-12 w-auto mb-2"}),t.jsx("p",{className:"text-center font-medium",children:"Wave"}),d==="wave"&&t.jsx(se,{className:"h-5 w-5 text-blue-500 mt-1"})]})}),t.jsx("div",{className:`border rounded-lg p-4 cursor-pointer transition-all ${d==="orange"?"border-orange-500 bg-orange-50 ring-2 ring-orange-200":"border-gray-300 hover:border-orange-300"}`,onClick:()=>Z("orange"),children:t.jsxs("div",{className:"flex flex-col items-center",children:[t.jsx("img",{src:oe,alt:"Orange Money",className:"h-12 w-auto mb-2"}),t.jsx("p",{className:"text-center font-medium",children:"Orange Money"}),d==="orange"&&t.jsx(se,{className:"h-5 w-5 text-orange-500 mt-1"})]})})]})]}),d==="wave"&&t.jsxs("div",{className:"mt-4 mb-6",children:[t.jsx("label",{htmlFor:"phone",className:"block text-sm font-medium text-gray-700 mb-1",children:"Numéro de téléphone Wave"}),t.jsx("input",{type:"tel",id:"phone",value:b,onChange:s=>z(s.target.value),placeholder:"77 123 45 67",className:`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 ${E.valid?"border-green-300 focus:ring-green-500":b?"border-red-300 focus:ring-red-500":"border-gray-300 focus:ring-blue-500"}`}),b&&t.jsx("p",{className:`text-xs mt-1 ${E.valid?"text-green-600":"text-red-600"}`,children:E.message}),t.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Entrez votre numéro Wave (format: 77XXXXXXX ou 78XXXXXXX)"})]}),d==="orange"&&t.jsxs("div",{className:"mt-4 mb-6",children:[t.jsx("label",{htmlFor:"phone-orange",className:"block text-sm font-medium text-gray-700 mb-1",children:"Numéro de téléphone Orange Money"}),t.jsx("input",{type:"tel",id:"phone-orange",value:b,onChange:s=>z(s.target.value),placeholder:"77 123 45 67",className:`w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 ${E.valid?"border-green-300 focus:ring-green-500":b?"border-red-300 focus:ring-red-500":"border-gray-300 focus:ring-orange-500"}`}),b&&t.jsx("p",{className:`text-xs mt-1 ${E.valid?"text-green-600":"text-red-600"}`,children:E.message}),t.jsxs("div",{className:"bg-orange-50 border border-orange-200 rounded-lg p-3 mt-2",children:[t.jsxs("div",{className:"flex items-center mb-1",children:[t.jsx($e,{className:"h-4 w-4 text-orange-600 mr-2"}),t.jsx("p",{className:"text-xs text-orange-700 font-medium",children:"QR Code + Numéro requis"})]}),t.jsx("p",{className:"text-xs text-orange-600",children:"Le numéro est requis pour la génération du QR Code Orange Money"})]})]}),(I||G)&&t.jsx("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg",children:t.jsxs("div",{className:"flex items-center",children:[t.jsx(Ee,{className:"h-5 w-5 text-red-500 mr-2"}),t.jsx("p",{className:"text-red-700 text-sm",children:I||G})]})}),t.jsx("div",{className:"flex items-center gap-4 mt-8",children:t.jsx(Q,{onClick:xe,disabled:D||!d||(d==="wave"||d==="orange")&&(!b||!E.valid),className:"w-full bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700 text-white font-medium py-3 px-6 rounded-lg transition-all duration-200",children:D?t.jsxs(t.Fragment,{children:[t.jsx(V,{className:"mr-2 h-4 w-4 animate-spin"}),"Traitement en cours..."]}):`Payer ${L(a)}`})})]})]})]})})})]})},qe=Te;export{qe as W};
